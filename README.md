# BOM 对比分析工具

一个纯前端、开箱即用的表格 BOM 比对与导出工具。无需后端、无需构建，双击 `index.html` 即可使用。

技术栈：Vue 3、Tailwind CSS、ExcelJS、Font Awesome。

当前版本：V2.5 - 网页版

## 为什么用它

- 支持一次导入多份表格，并即时选择其中任意两份进行并列预览与对比
- 支持 Excel(.xlsx) 与 HTML 表格文件
- 颜色高亮标注差异，列筛选/颜色筛选双管齐下
- 一键导出两表与对比结果（含图例、汇总、着色、边框、列宽自适应）
- 纯浏览器离线运行，数据不出本地

## 快速开始

1. 直接在浏览器中打开 `index.html`。
2. 点击“选择文件”，批量导入 xlsx/html。
3. 在“已导入文件”列表中勾选文件进行预览（最多并列 2 个），可进行对比。
4. 开启“启动对比”，根据色块快速定位差异；可用列筛选与颜色筛选组合查看。
5. 点击“导出对比结果”生成带有着色和结果页的 Excel 文件。

提示：导入的 Excel 文件若加密，请先解密。

## 支持的文件类型

- .xlsx：使用 ExcelJS 解析（读取第一个工作表）
- .html/.htm：解析页面中的 table 元素
- .xls：暂不支持（请另存为 .xlsx 后导入）

## 导入与清洗流程（核心规则）

工具在导入时会做最少必要的数据清洗，尽量贴近原始数据，仅为保证对比正确性而做的约束如下：

1. 表头识别与无效行删除
	- HTML：在每个 table 内寻找“第一列为 零件号/供应商零件号/客户零件号”的行作为表头；删除后续误入的表头行；删除含合并单元格的行；删除第一列以 `Design` 开头的行。
	- Excel：读取完整网格并识别合并区域；同样按“第一列令牌”识别表头并删除误入表头/合并/Design 行；若找不到表头，则回退到“列1..列N”的临时列名策略。

2. 关键列规整（仅“零件号/供应商零件号”）
	- 删除不可见字符：U+200B..U+200D（零宽）、U+FEFF、U+00AD（软连字符）
	- 删除所有空白字符：空格/回车/制表/不间断空格等一律去掉，不保留

3. PN 填充
	- 若“零件号”与“供应商零件号”都为空，丢弃该行
	- 若“零件号”为空但“供应商零件号”有值：将“零件号”填为【供应商零件号】（使用规整后的值）

4. WIRE/线束/导线 规范化与聚合
	- 若“类型” ∈ {WIRE, 线束, 导线} 且 PN 形如 A-B-C（三段），则规范为 “A-B”，便于聚合
	- 按“零件号”聚合：“数量”相加，其它字段保留首行值

5. 排序
	- 使用 Intl.Collator 进行自然排序（numeric: true，忽略大小写），按“零件号”升序

## 对比规则与颜色含义

对比以“零件号”为主键，优先级如下（高→低）：

1. 零件号命中对表：
	- 数量相同 → 绿色（数量相同）
	- 数量不同 → 蓝色（数量不同）

2. 零件号未命中对表：
	- 若本行“供应商零件号”与对表中“相对于本表为红色的行”的供应商号有交集 → 橙色（供应商匹配）
	- 否则 → 红色（未找到）

界面图例对应：

- 红：该行未在对表中找到
- 橙：该行虽未找到，但供应商零件号匹配
- 蓝：该行在对表找到，但数量不同
- 绿：该行与对表中数据一致

备注：通过对关键列的“不可见字符”清理与“所有空白删除”，可显著减少“肉眼相同但字符串不同”的误判。

## 筛选与排序

- 列筛选：任意列可下拉筛选，支持搜索、全选、清除；多个列条件按“与”关系组合
- 颜色筛选：对比模式下可在每张表右上角按红/橙/蓝/绿筛选（同一时间每张表最多选一种）
- 排序：对比模式下，界面展示按“颜色优先级（红→橙→蓝→绿）+ 零件号自然排序”

## 导出能力

导出为 .xlsx，包含以下几种情况：

- 单表导出：原样数据（应用了列筛选但不着色），包含表头、边框与列宽自适应
- 两表导出（未启动对比）：两张原样工作表
- 两表导出（已启动对比）：
	- 两张着色工作表（可选“对比标记”列：未找到/供应商匹配/数量不同/数量相同）
	- “对比结果”汇总页：
		- 左右各自的小计（红/橙/蓝/绿行数）与着色数据视图
		- 导线数量差值表（仅类型为 WIRE/线束/导线，且为蓝色类：PN 命中但数量不同）
	- 全部工作表添加边框与列宽自适应，包含图例区域

## 已知限制与注意事项

- 仅解析 Excel 的第一个工作表
- .xls 暂不支持（请另存为 .xlsx）
- 含合并单元格的“行”会被整体剔除（视为不可靠）
- 第一列以 `Design` 开头的行会被删除
- 若未识别到表头，将回退到临时列名策略，尽量保证可用
- 仅对“零件号/供应商零件号”执行字符级规整，其它列原样保留
- 仅可并列对比 2 张表

## 隐私与离线

本工具为纯前端应用，所有数据在浏览器本地解析处理，不会上传网络；可在离线环境使用。

## 开发说明

- 代码集中在 `index.html`（Vue 3 组合式 API + 原生模块）
- 无需打包构建，直接打开即可；依赖均通过 CDN 引入
- UI 使用 Tailwind CSS；Excel 读写使用 ExcelJS

## 交流与问题反馈

为特定软件 CHS 进行的定制开发，欢迎通过 Issue 提交问题或建议，描述请尽量包含：

- 期望行为 vs 实际行为
- 关键样例（可脱敏）与步骤
- 浏览器版本与系统信息

## 版本更新历程

- V2.3
	- 网页版本发布，将原本基于 Excel 宏的方法移植到单 HTML 文件中，实现仍能本地处理
	- 支持 HTML 原文件导入和分析
	- 优化代码结构
- V2.4
	- 原 SheetJS 无法生成要求格式的 Excel 文件，改用 ExcelJS
	- 优化函数处理逻辑
- V2.5
	- 增加多文件对比结果导出功能，现在可以多选多份文件完成对比结果的批量导出
	- 重构和梳理整体代码
	- 优化界面显示，现在的动画更符合预期

---

Made with Vue 3, Tailwind CSS, ExcelJS, Github Copilot, and ❤️
